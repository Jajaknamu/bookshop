# ğŸ“š BookShop - ì£¼ë¬¸ ê´€ë¦¬ ì‹œìŠ¤í…œ
**Java / Spring Boot / Spring Data JPA / REST API ê¸°ë°˜ ì‚¬ì´ë“œ í”„ë¡œì íŠ¸**   
**â•ê¸°ëŠ¥ í™•ì¥: TossPayments ê²°ì œ ì‹œìŠ¤í…œ ì¶”ê°€**

> ğŸ“¬ ì´ë©”ì¼: heyfer6867@gmail.com  
> ğŸ’¼ í¬íŠ¸í´ë¦¬ì˜¤: [ìì„¸íˆ ë³´ê¸° (Notion)](https://unique-income-725.notion.site/BookShop-1d2dee6a3251801caf76cca3b5dff517?source=copy_link)

## ğŸ’¡ í”„ë¡œì íŠ¸ ì†Œê°œ
> `ì‹¤ì „! ìŠ¤í”„ë§ ë¶€íŠ¸ì™€ JPA í™œìš©1 - ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ` ê°•ì˜ë¥¼ ì°¸ê³ í•˜ì—¬ ë§Œë“  í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.  
> ì´ í”„ë¡œì íŠ¸ëŠ” ê°•ì˜ ì˜ˆì œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‹œì‘í–ˆì§€ë§Œ ë‹¨ìˆœ êµ¬í˜„ì„ ë„˜ì–´ ìƒí’ˆ-íšŒì›-ì£¼ë¬¸ ë„ë©”ì¸ ê°„ ì—°ê´€ê´€ê³„ ì„¤ê³„, API ì„¤ê³„, íŠ¸ëœì­ì…˜ íë¦„ì— ëŒ€í•œ ì´í•´ë¥¼ í™•ì¥í•˜ëŠ” ë° ëª©ì ì„ ë‘ì—ˆìŠµë‹ˆë‹¤.   

> ê¸°ì¡´ ì˜ˆì œì¸ Thymeleafë¥¼ í†µí•œ **ì„œë²„ ë Œë”ë§** êµ¬í˜„ì„ ë„˜ì–´ **REST API**ë¥¼ ì ìš©í•˜ì—¬ ë°ì´í„° ì¡°íšŒì™€ ê´€ë¦¬ ê¸°ëŠ¥ì„ ê°œì„ í–ˆìŠµë‹ˆë‹¤.   
> ì£¼ë¬¸ ì‹œìŠ¤í…œì—ì„œ **Toss Payments**ë¥¼ í™œìš©í•˜ì—¬ ì‹¤ì œ í† ìŠ¤ì•±ìœ¼ë¡œ ì—°ë™í•´ ê²°ì œê°€ëŠ¥ ë° ì·¨ì†Œ ë¡œì§ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

## ğŸ‘¥ ê°œë°œ ê¸°ê°„
#### 2025.04.07 ~ 2025.04.27


## âš™ï¸ ê°œë°œ í™˜ê²½ ë° ê¸°ìˆ  ìŠ¤íƒ

| Category            | Stack                                                                 |
|-----------------    |-----------------------------------------------------------------------|
| **Language**        | Java 17                                                               |
| **Backend**         | Spring Boot 3.2.5                                                     |
| **Frontend**        | Thymeleaf, HTML/CSS, JavaScript, AJAX                                 |
| **Template Engine** | Thymeleaf                                                             |
| **Database / ORM**  | H2, Spring Data JPA                                                   |
| **Build Tool**      | Gradle                                                                |
| **IDE**             | IntelliJ IDEA                                                         |
| **Tools**           | Git, GitHub                                                           |
| **Testing**         |JUnit                                                                  |


## ğŸ§© í•µì‹¬ ê¸°ëŠ¥
- íšŒì›ê°€ì… / ë¡œê·¸ì¸ / ì£¼ë¬¸ ë‚´ì—­ í™•ì¸
- ìƒí’ˆ ë“±ë¡, ìˆ˜ì •, ì‚­ì œ (ê´€ë¦¬ì ì „ìš©)
- ì£¼ë¬¸ ìƒì„± / ì·¨ì†Œ + ì¬ê³  ìˆ˜ëŸ‰ ë°˜ì˜
- REST API ê¸°ë°˜ CRUD êµ¬í˜„
  
**â•ê¸°ëŠ¥ í™•ì¥**
- **ê²°ì œ ìš”ì²­/ìŠ¹ì¸**: Toss SDKë¥¼ í†µí•œ ê²°ì œì°½ í˜¸ì¶œ â†’ ì„œë²„ API(/api/payments/success)ì—ì„œ ê²°ì œ ê²€ì¦ ë° ì£¼ë¬¸ ìƒì„±
- **ì£¼ë¬¸-ê²°ì œ ì—°ë™**: ê²°ì œ ì„±ê³µ ì‹œ OrderService.order() í˜¸ì¶œë¡œ ì£¼ë¬¸ ë° ê²°ì œ ë‚´ì—­ DB ì €ì¥
- **ê²°ì œ ê²€ì¦**: Toss REST APIë¥¼ í†µí•´ ê²°ì œ ê¸ˆì•¡/ìƒíƒœ ê²€ì¦ í›„ DB ë°˜ì˜
- **ê²°ì œ ì·¨ì†Œ**: ì£¼ë¬¸ ì·¨ì†Œ ì‹œ Toss ê²°ì œ ì·¨ì†Œ API ì—°ë™ â†’ ì‹¤ì œ ê²°ì œ ì·¨ì†Œ + DB ìƒíƒœ ì—…ë°ì´íŠ¸

## ğŸ§¾ API ëª…ì„¸ì„œ

### ê°„ë‹¨ ìš”ì•½

| Method   | URL                       | ìš”ì²­ DTO            | ì‘ë‹µ DTO                   | ì„¤ëª…          |
| -------- | ------------------------- | ----------------- | ------------------------ | ----------- |
| `GET`    | `/api/orders`             | ì—†ìŒ                | `List<OrderResponseDto>` | ì „ì²´ ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ |
| `POST`   | `/api/orders`             | `OrderRequestDto` | `Long` (ì£¼ë¬¸ ID)           | ì£¼ë¬¸ ìƒì„±       |
| `PATCH`  | `/api/orders/{id}/cancel` | ì—†ìŒ                | `String`                 | ì£¼ë¬¸ ì·¨ì†Œ       |
| `GET`    | `/api/orders/{id}`        | ì—†ìŒ                | `OrderResponseDto`       | ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ    |
|          |                           |                     |                          |                  |
| `GET`    | `/api/members`            | ì—†ìŒ                | `List<MemberDto>`        | ì „ì²´ íšŒì› ëª©ë¡ ì¡°íšŒ |
| `POST`   | `/api/members`            | `MemberDto`       | `Long` (íšŒì› ID)           | íšŒì› ë“±ë¡       |
| `PATCH`  | `/api/members/{id}`       | `MemberUpdateDto` | `String`                 | íšŒì› ì •ë³´ ìˆ˜ì •    |
| `DELETE` | `/api/members/{id}`       | ì—†ìŒ                | `String`                 | íšŒì› ì‚­ì œ       |
|          |                           |                     |                          |                 |
| `GET`    | `/api/items`              | ì—†ìŒ                | `List<BookDto>`          | ì „ì²´ ìƒí’ˆ ëª©ë¡ ì¡°íšŒ |
| `POST`   | `/api/items`              | `BookDto`         | `Long` (ìƒí’ˆ ID)           | ìƒí’ˆ ë“±ë¡       |
| `GET`    | `/api/items/{id}`         | ì—†ìŒ                | `BookDto`                | ìƒí’ˆ ìƒì„¸ ì¡°íšŒ    |
| `PATCH`  | `/api/items/{id}`         | `BookDto`         | `String`                 | ìƒí’ˆ ìˆ˜ì •       |
| `DELETE` | `/api/items/{id}`         | ì—†ìŒ                | `String`                 | ìƒí’ˆ ì‚­ì œ       |

### â•ê²°ì œAPI
| Method | URL                     | ì„¤ëª…                 |
| ------ | ----------------------- | ------------------ |
| GET   | `/api/payments/success` | í† ìŠ¤ ê²°ì œ ì„±ê³µ ì½œë°± ì²˜ë¦¬              |
| POST   | `/api/payments/cancel` | ê²°ì œ ì·¨ì†Œ |
| GET   | `/api/payments/fail`  | í† ìŠ¤ ê²°ì œ ì‹¤íŒ¨ ì½œë°± ì €ì¥/ì‘ë‹µ          |
| GET   | `/payments/view/success` | ê²°ì œ ì„±ê³µ ê²°ê³¼ í™”ë©´ ë Œë”  |
| GET | `/payments/view/fail`| ê²°ì œ ì‹¤íŒ¨ ì‹œ í™”ë©´ ì´ë™|

â¡ï¸ [ğŸ“‘ API ìƒì„¸ ëª…ì„¸ ë³´ê¸° (Notion)](https://unique-income-725.notion.site/BookShop-API-214dee6a325180abba7bfe1c49af9e8e?source=copy_link)


## ğŸ—‚ï¸ ë””ë ‰í† ë¦¬ êµ¬ì¡° (ìš”ì•½)

```bash
ğŸ“¦ src
 â”£ ğŸ“‚main
 â”ƒ â”£ ğŸ“‚config         â†’ ì„¤ì • í´ë˜ìŠ¤
 â”ƒ â”£ ğŸ“‚controller     â†’ REST API ì»¨íŠ¸ë¡¤ëŸ¬
 â”ƒ â”£ ğŸ“‚domain         â†’ í•µì‹¬ ë„ë©”ì¸ ê°ì²´ ë° ì—°ê´€ê´€ê³„ ì„¤ì •
 â”ƒ â”£ ğŸ“‚dto            â†’ ìš”ì²­/ì‘ë‹µ DTO
 â”ƒ â”£ ğŸ“‚exception      â†’ ì˜ˆì™¸ ì²˜ë¦¬
 â”ƒ â”£ ğŸ“‚repository     â†’ JPA Repository
 â”ƒ â”£ ğŸ“‚service        â†’ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
 â”— ğŸ“‚test             â†’ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
``` 

## ğŸ“Œ í”„ë¡œì íŠ¸ ëª©í‘œ ë° í•™ìŠµ í¬ì¸íŠ¸
- JPA ì—°ê´€ê´€ê³„ ë§¤í•‘ (ë‹¨ë°©í–¥/ì–‘ë°©í–¥)
- RESTful URL ì„¤ê³„ ë° HTTP ë©”ì„œë“œ í™œìš©
- ìš”ì²­/ì‘ë‹µ DTO ì‚¬ìš© ë° API ëª…ì„¸í™”
- ê²°ì œ ì‹œ @RequestParamìœ¼ë¡œ ê°’ ë°›ìŒ -> ì¶”í›„ @RequestBody + DTOë¡œ ë¦¬í™í† ë§


## ğŸ“ ê¸°íƒ€ ì°¸ê³ 
- API ë¬¸ì„œí™”ëŠ” Swagger ì‚¬ìš© â†’ ì•„ì§ ìë™í™”ê¹Œì§€ëŠ” ì‚¬ìš©x, Markdown ìˆ˜ë™ ë¬¸ì„œí™”
- CI/CD, ë°°í¬ëŠ” í¬í•¨ë˜ì§€ ì•ŠìŒ (ì¶”í›„ EC2 + Docker ëª©í‘œ)

## âœ… ì‹œì—° ì˜ìƒ

> **íšŒì›ê°€ì…, ì£¼ë¬¸ ìƒì„±/ì·¨ì†Œ, ìƒí’ˆ ë“±ë¡/ìˆ˜ì •/ì‚­ì œ** ë“± ìì„¸í•œ ì‹œì—° í™”ë©´ì€ [ë…¸ì…˜ í¬íŠ¸í´ë¦¬ì˜¤](https://www.notion.so/BookShop-1d2dee6a3251801caf76cca3b5dff517?pvs=97#1d7dee6a3251806da53ce7674a512ed7)ì— í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

> https://github.com/user-attachments/assets/99201ec4-f544-4481-afa2-336c51e437a2   

> **ê²°ì œ ë° ì·¨ì†Œ**
 
> https://github.com/user-attachments/assets/b30b009c-691f-4eb0-9d7b-d4e31eb67f2e
> 

## ğŸ“Œ ì¼ë¶€ ì½”ë“œ ì˜ˆì‹œ -> ì£¼ë¬¸ ìƒì„± ë¡œì§ 
- íšŒì›, ìƒí’ˆ, ë°°ì†¡ ì •ë³´ë¥¼ ì¡°íšŒí•˜ì—¬ í•˜ë‚˜ì˜ ì£¼ë¬¸ ê°ì²´ë¡œ ìƒì„±í•˜ëŠ” ë©”ì„œë“œ
```

    //ì£¼ë¬¸ ìƒì„±
    @Transactional
    public Long order(Long memberID, Long itemId, int count) {
        //ì—”í‹°í‹° ì¡°íšŒ
        Member member = memberRepository.findOne(memberID);
        Item item = itemRepository.findOne(itemId);

        //ë°°ì†¡ì •ë³´ ìƒì„±
        Delivery delivery = new Delivery();
        delivery.setAddress(member.getAddress());

        //ì£¼ë¬¸ìƒí’ˆ ìƒì„±
        OrderItem orderItem = OrderItem.createOrderItem(item, item.getPrice(), count);

        //ì£¼ë¬¸ ìƒì„±
        Order order = Order.createOrder(member, delivery, orderItem);

        //ì£¼ë¬¸ ì €ì¥
        orderRepository.save(order);

        return order.getId();
    }
```

## ğŸ“Œ ì¼ë¶€ ì½”ë“œ ì˜ˆì‹œ -> Tossê²°ì œ ë¡œì§

```
//Toss Payments ê²°ì œ ìŠ¹ì¸(í™•ì¸) ìš”ì²­ ë©”ì„œë“œ.
public void verifyPayment(String paymentKey, String orderId, int amount) {
        // 1) Toss ê²°ì œ ìŠ¹ì¸(í™•ì¸) API ì—”ë“œí¬ì¸íŠ¸
        String url = "https://api.tosspayments.com/v1/payments/confirm";

        // 2) HTTP í—¤ë” êµ¬ì„± (Basic ì¸ì¦ + JSON ì»¨í…íŠ¸ íƒ€ì…)
        HttpHeaders headers = new HttpHeaders();
        String encodedAuth = Base64.getEncoder().encodeToString((secretKey + ":").getBytes(StandardCharsets.UTF_8));
        headers.set("Authorization", "Basic " + encodedAuth);
        headers.setContentType(MediaType.APPLICATION_JSON);

        // 3) ìš”ì²­ ë°”ë””(JSON) ìƒì„±
        Map<String, Object> body = new HashMap<>();
        body.put("paymentKey", paymentKey);
        body.put("orderId", orderId);
        body.put("amount", amount);

        // 4) HttpEntityë¡œ í—¤ë”ì™€ ë°”ë””ë¥¼ ë¬¶ì–´ ì „ì†¡ ì¤€ë¹„
        HttpEntity<Map<String, Object>> request = new HttpEntity<>(body, headers);

        try {
            // 5) Toss ì„œë²„ì— ê²°ì œ ìŠ¹ì¸(í™•ì¸) ìš”ì²­ ì „ì†¡ (POST)
            ResponseEntity<String> response = restTemplate.postForEntity(url, request, String.class);

            // 6) ìƒíƒœ ì½”ë“œê°€ 2xxê°€ ì•„ë‹ˆë©´ ìŠ¹ì¸ ì‹¤íŒ¨ë¡œ ê°„ì£¼
            if (!response.getStatusCode().is2xxSuccessful()) {
                throw new IllegalStateException("Toss ê²°ì œ í™•ì¸ ì‹¤íŒ¨ : ì‘ë‹µì½”ë“œ = " + response.getStatusCode());
            }
            // 7) ìŠ¹ì¸ ì„±ê³µ ë¡œê·¸ ì¶œë ¥
            log.info("Toss ê²°ì œ ê²€ì¦ ì„±ê³µ: {} ", response.getBody());
        } catch (HttpClientErrorException e) {
            // 8) Tossê°€ 4xx ì—ëŸ¬ë¥¼ ë°˜í™˜í•œ ê²½ìš°(ìš”ì²­ íŒŒë¼ë¯¸í„° ì˜¤ë¥˜, ì´ë¯¸ ìŠ¹ì¸ëœ ê²°ì œ ë“±)
            log.info("Toss ê²°ì œ í™•ì¸ ì‹¤íŒ¨ (HTTP ì˜¤ë¥˜): {}", e.getResponseBodyAsString(), e);
            throw new IllegalStateException("ê²°ì œ ê²€ì¦ ì‹¤íŒ¨: " + e.getResponseBodyAsString(), e);
        } catch (Exception e) {
            // 10) ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ, íƒ€ì„ì•„ì›ƒ, ì§ë ¬í™” ë¬¸ì œ ë“± ê·¸ ì™¸ ì˜ˆì™¸ ì²˜ë¦¬
            log.info("Toss ê²°ì œ í™•ì¸ ì¤‘ ì˜ˆì™¸ ë°œìƒ", e);
            throw new RuntimeException("Toss ê²°ì œ í™•ì¸ ì¤‘ ì˜¤ë¥˜: " + e.getMessage(), e);
        }
    }
```




