<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>상품 목록</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<h1>📦 상품 목록</h1>

<table border="1" id="itemTable">
    <thead>
    <tr>
        <th>상품명</th>
        <th>가격</th>
        <th>재고</th>
        <th>상품 ID</th>
    </tr>
    </thead>
    <tbody>
    <!-- JS가 여기에 데이터를 삽입함 -->
    </tbody>
</table>

<script>
    $(document).ready(function () {
        $.get("/api/items", function (items) {
            items.forEach(item => {
                $("#itemTable tbody").append(`
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.price}</td>
                        <td>${item.stockQuantity}</td>
                        <td>${item.id}</td>
                    </tr>
                `);
            });
        });
    });
</script>

</body>
</html>


<!--v2 버전 해보기-->
<script>
    // PortOne 로딩 대기
    function waitPortOneLoaded() {
        return new Promise((resolve) => {
            const check = setInterval(() => {
                if (window.PortOne) {
                    clearInterval(check);
                    resolve();
                }
            }, 100);
        });
    }

    // 전역에 결제 함수 등록
    window.requestPay = async function () {
        await waitPortOneLoaded();

        function randomId() {
            return [...crypto.getRandomValues(new Uint32Array(2))]
                .map((word) => word.toString(16).padStart(8, "0"))
                .join("");
        }

        const paymentId = randomId();

        const payment = await PortOne.requestPayment({
            storeId: "store-5290c2f9-b27d-4bf3-a88a-48717e658e5e", // 예: iamporttest_3
            channelKey: "channel-key-4ea5e726-aaab-43e4-a936-1ea0c68bfa69", // 예: channel-key-xxxx...
            paymentId: paymentId,
            orderName: "테스트 상품",
            totalAmount: 100,
            currency: "KRW",
            payMethod: "CARD",
            redirectUrl: "https://8e0b6d606c26.ngrok-free.app/payment/success"
        });

        if (payment.code !== undefined) {
            alert("결제 실패: " + payment.message);
            return;
        }

        alert("결제 성공: paymentId = " + payment.paymentId);
    };
</script>