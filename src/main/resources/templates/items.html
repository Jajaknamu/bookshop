<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>ìƒí’ˆ ëª©ë¡</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<h1>ğŸ“¦ ìƒí’ˆ ëª©ë¡</h1>

<table border="1" id="itemTable">
    <thead>
    <tr>
        <th>ìƒí’ˆëª…</th>
        <th>ê°€ê²©</th>
        <th>ì¬ê³ </th>
        <th>ìƒí’ˆ ID</th>
    </tr>
    </thead>
    <tbody>
    <!-- JSê°€ ì—¬ê¸°ì— ë°ì´í„°ë¥¼ ì‚½ì…í•¨ -->
    </tbody>
</table>

<script>
    $(document).ready(function () {
        $.get("/api/items", function (items) {
            items.forEach(item => {
                $("#itemTable tbody").append(`
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.price}</td>
                        <td>${item.stockQuantity}</td>
                        <td>${item.id}</td>
                    </tr>
                `);
            });
        });
    });
</script>

</body>
</html>


<!--v2 ë²„ì „ í•´ë³´ê¸°-->
<script>
    // PortOne ë¡œë”© ëŒ€ê¸°
    function waitPortOneLoaded() {
        return new Promise((resolve) => {
            const check = setInterval(() => {
                if (window.PortOne) {
                    clearInterval(check);
                    resolve();
                }
            }, 100);
        });
    }

    // ì „ì—­ì— ê²°ì œ í•¨ìˆ˜ ë“±ë¡
    window.requestPay = async function () {
        await waitPortOneLoaded();

        function randomId() {
            return [...crypto.getRandomValues(new Uint32Array(2))]
                .map((word) => word.toString(16).padStart(8, "0"))
                .join("");
        }

        const paymentId = randomId();

        const payment = await PortOne.requestPayment({
            storeId: "store-5290c2f9-b27d-4bf3-a88a-48717e658e5e", // ì˜ˆ: iamporttest_3
            channelKey: "channel-key-4ea5e726-aaab-43e4-a936-1ea0c68bfa69", // ì˜ˆ: channel-key-xxxx...
            paymentId: paymentId,
            orderName: "í…ŒìŠ¤íŠ¸ ìƒí’ˆ",
            totalAmount: 100,
            currency: "KRW",
            payMethod: "CARD",
            redirectUrl: "https://8e0b6d606c26.ngrok-free.app/payment/success"
        });

        if (payment.code !== undefined) {
            alert("ê²°ì œ ì‹¤íŒ¨: " + payment.message);
            return;
        }

        alert("ê²°ì œ ì„±ê³µ: paymentId = " + payment.paymentId);
    };
</script>